{% extends "layout.html" %} {% set active_page = "services" %} {% block content %}
<div
  class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"
>
  <h2 class="h4">{% if title %}{{title}}{% else %}No Title{% endif %}</h2>
  <div class="btn-toolbar mb-2 mb-md-0">
    <div class="dropdown">
      <button
        class="btn btn-sm btn-outline-primary mr-2 dropdown-toggle bulk_assign disabled"
        type="button"
        id="dropdownMenuButton"
        data-toggle="dropdown"
        aria-haspopup="true"
        aria-expanded="false"
      >
        <span data-feather="settings"></span> Zbiorowa akcja ( ͡° ͜ʖ ͡°)
      </button>
      <div class="dropdown-menu dd-sm" aria-labelledby="dropdownMenuButton">
        <div class="dropdown-divider"></div>
        <a
          class="dropdown-item"
          data-toggle="modal"
          data-target="#servicesDeleteModal"
          href="#"
          >Usuń</a
        >
        <div class="dropdown-divider"></div>
        <a class="dropdown-item" id="export_services_to_csv" href="#"
          >Export do CSV</a
        >
      </div>
    </div>

    {% if current_user.is_admin %}
    <a
      class="btn btn-sm btn-outline-secondary mr-2"
      role="button"
      href="{{ url_for('services.import_bulk_services') }}"
    >
      <span data-feather="upload"></span>
      Importuj ...
    </a>
    {% endif %}
    <a
      class="btn btn btn-sm btn-outline-primary"
      role="button"
      href="{{ url_for('services.new_service') }}"
    >
      <span data-feather="plus"></span>
      Nowa czynność serwisowa
    </a>
  </div>
</div>
{% include "services/filters.html" %} {% if services.items()|length > 0 %}
<div class="table-responsive">
  <table class="table table-striped table-hover fixed-layout-table">
    <thead class="thead-light">
      <tr>
        <th width="40" scope="col">
          <input type="checkbox" id="select_all" value="all" />
        </th>
        <th width="150"></th>
        <th width="250" scope="col">Nazwa</th>
        <th width="150" scope="col">Cena</th>
      </tr>
    </thead>
    <tbody>
      {% for service in services.items() %}
      <tr>
        <th scope="row">
          <input class="cb" type="checkbox" value="{{ service.id }}" />
        </th>
        <th>
          <a
            href="{{ url_for('services.update_service', service_id=service.id) }}"
            class="btn btn-outline-secondary btn-sm mr-1"
            role="button"
          >
            <span data-feather="edit"></span>
          </a>
          <a
            href="#"
            data-toggle="modal"
            data-target="#singleServiceDeleteModal_{{ service.id }}"
            class="btn btn-outline-secondary btn-sm mr-1"
            role="button"
          >
            <span data-feather="trash"></span>
          </a>
          {% with service_id=service.id %} {% include
          'services/single_service_delete_modal.html' %} {% endwith %}
          <a
            href="{{ url_for('services.get_service_view', service_id=service.id) }}"
            class="btn btn-outline-secondary btn-sm mr-1"
            role="button"
          >
            <span data-feather="arrow-up-right"></span>
          </a>
        </th>
        <td>{{ service.name }}</td>
        <td>{{ service.price }} zł</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- pagination -->
{% if services.total_records > 10 %} {% with view_id="services.get_services_view",
items=services %} {% include "common/pagination.html" %} {% endwith %} {% endif %}
{% else %}
<div class="container text-center pt-4">
  <div><span data-feather="eye-off"></span></div>
  <p>Brak czynnośći serwisowych. Prosze utworzyć nową czynność serwisową.</p>
</div>
{% endif %}
<script>
  $(document).ready(function () {
    var items = [];

    $("#select_all").on("click", function () {
      if ($(this).is(":checked")) {
        $(".cb").prop("checked", true);
      } else {
        $(".cb").prop("checked", false);
      }
      toggle_convert_lead_btn();
    });

    $(".cb").on("click", function () {
      toggle_convert_lead_btn();
    });

    function toggle_convert_lead_btn() {
      items = [];
      $(".cb").each(function () {
        if ($(this).is(":checked")) {
          items.push($(this).val());
        }
      });

      if (items.length > 0) {
        $("#convert_lead").removeClass("disabled");
        $(".bulk_assign").removeClass("disabled");
      } else {
        $("#convert_lead").addClass("disabled");
        $(".bulk_assign").addClass("disabled");
      }
    }

    $(".ba_modal").on("show.bs.modal", function (e) {
      // do something...
      $(".modal-notif-area").html(`
                <div class="alert alert-success" role="alert">
                  Wybrałeś <strong>${items.length}</strong> czynnośći serwisowych do masowej akcji.
                </div>`);

      // store the values
      console.log(items);
      $(".services_data").val(items);
    });

    $("#export_services_to_csv").on("click", function (e) {
      e.preventDefault();
      window.location = "{{ url_for('services.write_to_csv') }}?service_ids=" + items;
    });
  });
</script>

<!-- Service Bulk Delete Modal -->
{% include "services/bulk_service_delete_modal.html" %} {% endblock %}
